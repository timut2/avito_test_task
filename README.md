Avito shop test task

## Запуск приложения
1.  Убедитесь, что Docker Desktop запущен.

2. Выполните команду для сборки и запуска контейнеров:
```bash
docker-compose up --build
```
## Тестирование
Чтобы проверить покрытие тестов, выполните:
```bash
go test -cover ./...
```
## Работа с базой данных
1. Найдите контейнер с базой данных:
```bash
docker ps
```
2. Зайдите в контейнер:
```bash
docker exec -it <container_id> bash
```
3. Подключитесь к базе данных:
```bash
psql -U postgres -d mydb
```
## Тестирование API
Для тестирования API использовался Postman.

## Вопросы и решения

Не описано какому формату должен соответствовать пароли и логин.
Формат логина и пароля  
Логин: длина не менее 5 символов. Формат свободный, так как интеграция с почтой или телефоном пока отсутствует.    
Пароль: длина не менее 8 символов, минимум одна цифра и один специальный символ (!@#$%^&*).

Хранение паролей  
Пароли хранятся в виде хэшей. Используется функция хеширования из библиотеки golang.org/x/crypto/bcrypt.

При создании нового пользователя транзакции не используются, так как в PostgreSQL операции INSERT и SELECT являются атомарными.

В таблице transactions используется зависимость REFERENCES users(id), чтобы предотвратить транзакции с несуществующими пользователями. Однако, если в будущем появится возможность удаления пользователей, это может привести к проблемам.

Нагрузочное тестирование  
Для нагрузочного тестирования использовался инструмент k6. В ходе тестирования была обнаружена проблема с гонкой данных при списании и зачислении монет. Для её устранения был добавлен SELECT FOR UPDATE, который блокирует строку до завершения текущей транзакции. Решил не прикладывать результат, так как он неправильный так как не очень понятно какой сценарий надо рассматривать. 

Индексы  
Для ускорения запросов использованы стандартные B-tree индексы на параметры, которые часто используются в запросах.

Миграции и сохранение данных  
Для управления миграциями используется инструмент migrate.  
Данные базы сохраняются между перезапусками контейнеров с помощью Docker volumes. Чтобы очистить базу, выполните:
```bash
docker volume rm avito_test_pgdata
```
Улучшения.  
Моменты, которые явно можно улучшить это логирование и архитектура проекта. Логирование делал до тестов, посмотрел доклад от авито, как можно реализовывать логирование через slog. Там нужно передавать контекст в функции, если начал переписывать, боялся, что ошибусь и не успею к дедлайну. 